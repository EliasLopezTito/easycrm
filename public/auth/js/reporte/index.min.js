$(function () { let e = $("#kpis"), t = $("#filter_lead_report"), a = ESTADOS.NUEVO, o = "Registros"; moment.locale("es"); var s = parseInt(moment().format("D")) >= 16 ? moment().startOf("month").add(15, "days") : moment().subtract(1, "month").startOf("month").add(15, "days"), n = parseInt(moment().format("D")) >= 16 ? moment().endOf("month").add(15, "days") : moment().subtract(1, "month").endOf("month").add(15, "days"); function r(e, t) { $("#reportrange span").html(e.format("MMMM D, YYYY") + " - " + t.format("MMMM D, YYYY")) } function i(t, a) { var s = new FormData; s.append("_token", $("input[name=_token]").val()), s.append("fecha_inicio", moment($("#reportrange").data("daterangepicker").startDate._d).format("YYYY-MM-DD")), s.append("fecha_final", moment($("#reportrange").data("daterangepicker").endDate._d).format("YYYY-MM-DD")), s.append("estado_id", t), s.append("action_full", a), s.append("filter_lead_report", $("#filter_lead_report").val()); let n = ""; a && e.html(n), actionAjax("/reporte", s, "POST", function (s) { $("button.lead-color").text("Registros (" + s.Clientes + ")"), t == ESTADOS.CIERRE ? ($(".leads-matriculados").removeClass("hidden"), $(".enterados-col").removeClass("col-md-12").addClass("col-md-6")) : ($(".leads-matriculados").addClass("hidden"), $(".enterados-col").removeClass("col-md-6").addClass("col-md-12")), a && ($.each(s.EstadosGlobal, function (e, t) { [ESTADOS.PERDIDO, ESTADOS.OTROS, ESTADOS.REASIGNADO].includes(t[3]) || (n += '<div><div class="content-count" style="background-color:' + t[2] + '"> ' + t[0] + " <br> <span> " + t[1] + " </span></div></div>") }), e.html(n), Highcharts.chart("vision_general_estados", { chart: { type: "column" }, title: { text: "Visi\xf3n General Estados" }, subtitle: { text: "Puedes ver m\xe1s detalle, dandole click a una de las siguientes columnas: " }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Registros" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.count})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>' }, series: [{ name: "Registros", colorByPoint: !0, data: s.Estados }], drilldown: { series: null } })), Highcharts.chart("enterados", { chart: { type: "column" }, title: { text: "\xbfC\xf3mo te enteraste de Loayza?" }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Registros" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.count})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>' }, series: [{ name: "Registros", colorByPoint: !0, data: s.Enterados }], drilldown: { series: null } }), Highcharts.chart("usuarios", { chart: { type: "column" }, title: { text: "Matr\xedculas por Asesoras" }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Registros" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.count})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>' }, series: [{ name: "Registros", colorByPoint: !0, data: s.Usuarios }], drilldown: { series: null } }), Highcharts.chart("carreras", { chart: { type: "column" }, title: { text: o + " por Carreras" }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Registros" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.count})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>' }, series: [{ name: "Registros", colorByPoint: !0, data: s.Carreras }], drilldown: { series: null } }), Highcharts.chart("cursos", { chart: { type: "column" }, title: { text: o + " por Cursos" }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Registros" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.count})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>' }, series: [{ name: "Registros", colorByPoint: !0, data: s.Cursos }], drilldown: { series: null } }), Highcharts.chart("turnos", { chart: { styledMode: !0 }, tooltip: { pointFormat: "Registros: <b>{point.y:,.0f}</b>" }, plotOptions: { series: { dataLabels: { enabled: !0, format: "<b>{point.name}</b> ({point.y:,.0f})", softConnector: !0 }, center: ["40%", "50%"], neckWidth: "30%", neckHeight: "25%", width: "80%" } }, title: { text: o + " por Turnos" }, series: [{ type: "pie", allowPointSelect: !0, keys: ["name", "y", "selected", "sliced"], data: s.Turnos, showInLegend: !0 }] }), Highcharts.chart("modalidades", { chart: { styledMode: !0 }, tooltip: { pointFormat: "Registros: <b>{point.y:,.0f}</b>" }, plotOptions: { series: { dataLabels: { enabled: !0, format: "<b>{point.name}</b> ({point.y:,.0f})", softConnector: !0 }, center: ["40%", "50%"], neckWidth: "30%", neckHeight: "25%", width: "80%" } }, title: { text: o + " por Modalidades" }, series: [{ type: "pie", allowPointSelect: !0, keys: ["name", "y", "selected", "sliced"], data: s.Modalidades, showInLegend: !0 }] }), Highcharts.chart("fuentes", { chart: { type: "column" }, title: { text: "Origen de los Registros" }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Registros" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.count})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>' }, series: [{ name: "Registros", colorByPoint: !0, data: s.Fuentes }], drilldown: { series: null } }), Highcharts.chart("leadsAsesoras", { chart: { type: "column" }, title: { text: "\xbfCuantos Leads le llegan a cada asesor?" }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Registros" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.y})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: se le registraron <b>{point.y} leads</b><br/>' }, series: [{ name: "Registros", colorByPoint: !0, data: s.recibeLeadAsesor }], drilldown: { series: null } }), Highcharts.chart("leadsAsesorasNuevos", { chart: { type: "column" }, title: { text: "Leads Nuevos por Asesor" }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Registros" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.y})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: se le registraron <b>{point.y} leads</b><br/>' }, series: [{ name: "Registros", colorByPoint: !0, data: s.recibeLeadsNuevosAsesor }], drilldown: { series: null } }) }) } $("#reportrange").daterangepicker({ autoUpdateInput: !1, startDate: s, endDate: n, ranges: { Hoy: [moment(), moment()], Ayer: [moment().subtract(1, "days"), moment().subtract(1, "days")], "\xdaltimos 7 d\xedas": [moment().subtract(6, "days"), moment()], "\xdaltimos 15 d\xedas": [moment().subtract(14, "days"), moment()], "\xdaltimos 30 d\xedas": [moment().subtract(29, "days"), moment()], "Esta Campa\xf1a": [parseInt(moment().format("D")) >= 16 ? moment().startOf("month").add(15, "days") : moment().subtract(1, "month").startOf("month").add(15, "days"), parseInt(moment().format("D")) >= 16 ? moment().endOf("month").add(15, "days") : moment().subtract(1, "month").endOf("month").add(15, "days")], "Este Mes": [moment().startOf("month"), moment().endOf("month")], "Mes Anterior": [moment().subtract(1, "month").startOf("month"), moment().subtract(1, "month").endOf("month")], "Desde Siempre": [moment(new Date("2018-01-01")), moment()] } }, r), r(s, n), i(a, !0), $(".list-button button").on("click", function () { o = (a = $(this).attr("data-info")) == ESTADOS.NUEVO ? "Registros" : "Matr\xedculas", i(a, !1) }), $("#reportrange").on("apply.daterangepicker", function (e, t) { i(a, !0) }), t.on("change", function () { i(a, !0) }), $("#btnRealizarFiltro").on("click", function () { actionAjax("/reporte", formData, "POST", function (e) { Highcharts.chart("pipeLine", { chart: { type: "funnel" }, title: { text: "Leads Por Estado" }, plotOptions: { series: { dataLabels: { enabled: !0, format: "<b>{point.name}</b> ({point.y:,.0f})", softConnector: !0 }, center: ["40%", "50%"], neckWidth: "30%", neckHeight: "25%", width: "80%" } }, legend: { enabled: !1 }, series: [{ name: "Leads registradas", data: e.Estados }], responsive: { rules: [{ condition: { maxWidth: 500 }, chartOptions: { plotOptions: { series: { dataLabels: { inside: !0 }, center: ["50%", "50%"], width: "100%" } } } }] } }), Highcharts.chart("vendedores", { chart: { type: "column" }, title: { text: "Lead Por Vendedor" }, subtitle: { text: "Puedes ver m\xe1s detalle, dandole click a una de las siguientes columnas: " }, accessibility: { announceNewData: { enabled: !0 } }, xAxis: { type: "category" }, yAxis: { title: { text: "Leads registradas" } }, legend: { enabled: !1 }, plotOptions: { series: { borderWidth: 0, dataLabels: { enabled: !0, format: "({point.count})" } } }, tooltip: { headerFormat: '<span style="font-size:11px">{series.name}</span><br>', pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>' }, series: [{ name: "Leads registradas", colorByPoint: !0, data: e.VendedorEstados }], drilldown: { series: e.VendedorEstadosDetalle } }), $("#modal-right").modal("hide") }) }) });